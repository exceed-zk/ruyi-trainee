# 格式化配置说明 - 04 注释格式化

## 概述
本文档详细说明与**注释格式化**相关的配置项，共约 20 个配置。

## 一、JavaDoc 注释配置

### 1.1 基本格式化
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.format_javadoc_comments" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.comment.format_block_comments" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.comment.format_line_comments" value="true"/>
```

**说明**: 启用所有类型注释的格式化。

### 1.2 JavaDoc 行长度
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.line_length" value="100"/>
<setting id="org.eclipse.jdt.core.formatter.lineSplit" value="120"/>
```

**说明**:
- JavaDoc 注释最大行长度: **100 字符**
- 代码最大行长度: **120 字符**

**示例**:
```java
/**
 * This is a long JavaDoc comment that will be wrapped at 100 characters to
 * ensure readability.
 */
public void method() {
    String code = "This code line can be up to 120 characters long";
}
```

### 1.3 JavaDoc 边界换行
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.new_lines_at_javadoc_boundaries" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.comment.new_lines_at_block_boundaries" value="true"/>
```

**示例**:
```java
/**               // /** 后换行
 * Comment text
 */               // */ 前换行

/*                // /* 后换行
 * Block comment
 */               // */ 前换行
```

## 二、JavaDoc 标签配置

### 2.1 标签对齐
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.align_tags_names_descriptions" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.comment.align_tags_descriptions_grouped" value="false"/>
```

**说明**: 不对齐标签名称和描述，保持自然格式。

**示例**:
```java
/**
 * Method description.
 *
 * @param name the name parameter
 * @param age the age parameter
 * @return the result
 */
// 正确: 标签不对齐

/**
 * Method description.
 *
 * @param  name the name parameter
 * @param  age  the age parameter      // 错误: 不要对齐
 * @return      the result
 */
```

### 2.2 标签缩进和格式
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.indent_root_tags" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.comment.indent_tag_description" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.comment.indent_parameter_description" value="false"/>
```

**说明**:
- 根标签缩进
- 标签描述不额外缩进
- 参数描述不额外缩进

**示例**:
```java
/**
 * Method description.
 *
 * @param longParameterName this is a long description that wraps to the
 * next line without additional indentation
 */
```

### 2.3 标签换行
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.insert_new_line_before_root_tags" value="insert"/>
<setting id="org.eclipse.jdt.core.formatter.comment.insert_new_line_for_parameter" value="do not insert"/>
<setting id="org.eclipse.jdt.core.formatter.comment.insert_new_line_between_different_tags" value="do not insert"/>
<setting id="org.eclipse.jdt.core.formatter.comment.javadoc_do_not_separate_block_tags" value="false"/>
```

**说明**:
- 根标签前插入换行
- 参数标签之间不插入额外换行
- 不同类型标签之间不强制换行

**示例**:
```java
/**
 * Method description.
 *              // 空行（根标签前）
 * @param a first parameter
 * @param b second parameter  // 参数间无额外空行
 * @return result
 * @throws Exception if error
 */
```

## 三、注释内容格式化

### 3.1 HTML 格式化
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.format_html" value="true"/>
```

**说明**: 格式化 JavaDoc 中的 HTML 标签。

**示例**:
```java
/**
 * This method does something.
 * <p>
 * More details here.
 * </p>
 * <ul>
 * <li>Item 1</li>
 * <li>Item 2</li>
 * </ul>
 */
```

### 3.2 源代码格式化
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.format_source_code" value="true"/>
```

**说明**: 格式化 JavaDoc 中的 `<pre>` 标签内的代码。

**示例**:
```java
/**
 * Example usage:
 * <pre>
 * MyClass obj = new MyClass();
 * obj.method();
 * </pre>
 */
```

### 3.3 空白行处理
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.clear_blank_lines_in_javadoc_comment" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.comment.clear_blank_lines_in_block_comment" value="false"/>
```

**说明**: 保留注释中的空白行。

## 四、注释行为配置

### 4.1 格式化头部
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.format_header" value="true"/>
```

**说明**: 格式化文件头部的注释（如版权声明）。

### 4.2 行长度计算
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.count_line_length_from_starting_position" value="true"/>
```

**说明**: 从注释起始位置计算行长度（考虑缩进）。

### 4.3 代码和注释间空格
```xml
<setting id="org.eclipse.jdt.core.formatter.comment.preserve_white_space_between_code_and_line_comments" value="false"/>
```

**说明**: 不保留代码和行注释之间的多余空格。

**示例**:
```java
int x = 5;     // 注释    // 多余空格会被移除
int x = 5; // 注释        // 格式化后
```

## 五、特殊注释配置

### 5.1 第一列注释
```xml
<setting id="org.eclipse.jdt.core.formatter.format_line_comment_starting_on_first_column" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.never_indent_line_comments_on_first_column" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.never_indent_block_comments_on_first_column" value="false"/>
```

**说明**:
- 格式化从第一列开始的行注释
- 第一列的注释也会被缩进

**示例**:
```java
public class Test {
// 这个注释会被缩进
    void method() {
        // 这个注释保持正常缩进
    }
}

// 格式化后:
public class Test {
    // 这个注释会被缩进
    void method() {
        // 这个注释保持正常缩进
    }
}
```

## 六、格式化控制

### 6.1 开关标签
```xml
<setting id="org.eclipse.jdt.core.formatter.use_on_off_tags" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.disabling_tag" value="@formatter:off"/>
<setting id="org.eclipse.jdt.core.formatter.enabling_tag" value="@formatter:on"/>
```

**说明**: 可以使用注释控制格式化的开关。

**示例**:
```java
// @formatter:off
int[][] matrix = {
    {1,  2,  3},
    {10, 20, 30},
    {100,200,300}  // 这部分不会被格式化
};
// @formatter:on

int x = 1+2+3;  // 这行会被格式化为 int x = 1 + 2 + 3;
```

## 七、注释类型对比

### 7.1 JavaDoc 注释
```java
/**
 * This is a JavaDoc comment.
 * Maximum line length: 100 characters
 * 
 * @param x parameter
 * @return result
 */
public int method(int x) {
    return x;
}
```

**特点**:
- 使用 `/** */`
- 用于 API 文档
- 最大行长度 100
- 支持 HTML 和 @tags
- 会被格式化

### 7.2 块注释
```java
/*
 * This is a block comment.
 * Maximum line length: 120 characters
 * Used for internal documentation.
 */
public void helper() {
}
```

**特点**:
- 使用 `/* */`
- 用于内部文档
- 最大行长度 120
- 会被格式化

### 7.3 行注释
```java
// This is a line comment, max 120 chars
int x = 5;  // Inline comment
```

**特点**:
- 使用 `//`
- 简短说明
- 最大行长度 120
- 会被格式化

## 八、总结

### 核心规则

1. ✅ **JavaDoc 行长度 100 字符**
2. ✅ **代码行长度 120 字符**
3. ✅ **格式化所有类型注释**
4. ✅ **不对齐标签和描述**
5. ✅ **根标签前插入空行**
6. ✅ **支持 @formatter:off/on 控制**
7. ✅ **格式化 HTML 和代码块**

### 行长度对照表

| 注释类型 | 最大长度 | 说明 |
|---------|---------|------|
| JavaDoc | 100 字符 | API 文档注释 |
| 块注释 | 120 字符 | 内部文档注释 |
| 行注释 | 120 字符 | 简短说明 |
| Java 代码 | 120 字符 | 代码行 |

### JavaDoc 最佳实践

```java
/**
 * Brief description of the method on the first line.
 * <p>
 * More detailed description can span multiple lines and paragraphs. Keep
 * lines under 100 characters.
 * </p>
 *
 * @param name the user name, must not be null
 * @param age the user age, must be positive
 * @return the created user object
 * @throws IllegalArgumentException if validation fails
 * @since 1.0
 * @see #relatedMethod()
 */
public User createUser(String name, int age) {
    // Implementation
}
```

### 格式化控制示例

```java
// 正常格式化区域
int normal = 1 + 2 + 3;

// @formatter:off
// 保持原样的代码
int[][]matrix={
{1,2,3},
{4,5,6}
};
// @formatter:on

// 恢复正常格式化
int another = 4 + 5 + 6;
```

---

**上一篇**: [格式化配置说明-03-换行和空行.md](./格式化配置说明-03-换行和空行.md)  
**下一篇**: [格式化配置说明-05-对齐和换行策略.md](./格式化配置说明-05-对齐和换行策略.md)
