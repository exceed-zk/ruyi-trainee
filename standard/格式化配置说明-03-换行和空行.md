# 格式化配置说明 - 03 换行和空行

## 概述
本文档详细说明与**换行和空行**相关的配置项，共约 60 个配置。

## 一、注解后的换行

### 1.1 类型注解
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_type" value="insert"/>
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_type_annotation" value="do not insert"/>
```

**示例**:
```java
@Entity                        // 类注解后换行
public class User {
}

List<@NonNull String> list;   // 类型注解后不换行
```

### 1.2 方法注解
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_method" value="insert"/>
```

**示例**:
```java
@Override                      // 方法注解后换行
public void method() {
}
```

### 1.3 字段注解
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_field" value="insert"/>
```

**示例**:
```java
@Autowired                     // 字段注解后换行
private Service service;
```

### 1.4 其他注解换行
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_parameter" value="do not insert"/>
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_local_variable" value="insert"/>
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_enum_constant" value="insert"/>
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_annotation_on_package" value="insert"/>
```

**示例**:
```java
void method(@NotNull String param) { }  // 参数注解不换行

@SuppressWarnings("unchecked")          // 局部变量注解换行
List<String> list = new ArrayList<>();

public enum Status {
    @Deprecated                         // 枚举常量注解换行
    OLD_STATUS
}
```

## 二、控制语句换行

### 2.1 if-else 语句
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_before_else_in_if_statement" value="do not insert"/>
```

**示例**:
```java
if (condition) {
    doSomething();
} else {                               // else 不换行，紧跟在 } 后
    doOther();
}
```

### 2.2 try-catch-finally
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_before_catch_in_try_statement" value="do not insert"/>
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_before_finally_in_try_statement" value="do not insert"/>
```

**示例**:
```java
try {
    riskyOperation();
} catch (Exception e) {                // catch 不换行
    handleError();
} finally {                            // finally 不换行
    cleanup();
}
```

### 2.3 do-while
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_before_while_in_do_statement" value="do not insert"/>
```

**示例**:
```java
do {
    process();
} while (condition);                   // while 不换行
```

## 三、空行配置

### 3.1 package 和 import
```xml
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_package" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_after_package" value="1"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_imports" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_after_imports" value="1"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_between_import_groups" value="0"/>
```

**示例**:
```java
package com.example;          // package 前 0 行，后 1 行
                              // 空行
import java.util.List;        // import 前 0 行
import java.util.ArrayList;
                              // import 后 1 行空行
public class MyClass {
}
```

### 3.2 类和类型声明
```xml
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_first_class_body_declaration" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_after_last_class_body_declaration" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_between_type_declarations" value="2"/>
```

**示例**:
```java
public class MyClass {
    private int x;             // 第一个声明前 0 行空行
    
    public void method() {
    }
}                              // 最后一个声明后 0 行空行
                               // 空行
                               // 空行
class AnotherClass {           // 类型声明间 2 行空行
}
```

### 3.3 字段和方法
```xml
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_field" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_method" value="1"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_abstract_method" value="1"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_member_type" value="0"/>
```

**示例**:
```java
public class MyClass {
    private int field1;        // 字段前 0 行
    private int field2;
                               // 方法前 1 行空行
    public void method1() {
    }
                               // 方法间 1 行空行
    public void method2() {
    }
}
```

### 3.4 方法体和代码块
```xml
<setting id="org.eclipse.jdt.core.formatter.number_of_blank_lines_at_beginning_of_method_body" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.number_of_blank_lines_at_end_of_method_body" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.number_of_blank_lines_before_code_block" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.number_of_blank_lines_at_beginning_of_code_block" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.number_of_blank_lines_at_end_of_code_block" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.number_of_blank_lines_after_code_block" value="0"/>
```

**示例**:
```java
public void method() {
    int x = 5;                 // 方法体开始无空行
    
    if (x > 0) {
        doSomething();         // 代码块开始无空行
    }
}                              // 方法体结束无空行
```

### 3.5 特殊空行
```xml
<setting id="org.eclipse.jdt.core.formatter.blank_lines_before_new_chunk" value="1"/>
<setting id="org.eclipse.jdt.core.formatter.blank_lines_between_statement_group_in_switch" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.number_of_empty_lines_to_preserve" value="3"/>
```

**说明**:
- 新代码块前 1 行空行
- switch 语句组间 0 行空行
- 保留最多 3 行连续空行

## 四、数组初始化换行

### 4.1 数组初始化
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_opening_brace_in_array_initializer" value="do not insert"/>
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_before_closing_brace_in_array_initializer" value="do not insert"/>
```

**示例**:
```java
int[] array = {1, 2, 3};      // 简单数组不换行

int[][] matrix = {            // 复杂数组可以换行
    {1, 2, 3},
    {4, 5, 6}
};
```

## 五、标签和语句换行

### 5.1 标签
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_after_label" value="do not insert"/>
```

**示例**:
```java
label: statement;             // 标签后不换行
```

## 六、文件结尾

### 6.1 文件结尾换行
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_new_line_at_end_of_file_if_missing" value="insert"/>
```

**说明**: 如果文件末尾缺少换行符，自动添加。

## 七、运算符换行控制

### 7.1 运算符换行位置
以下配置控制换行时运算符的位置（在新行开头还是旧行结尾）：

```xml
<setting id="org.eclipse.jdt.core.formatter.wrap_before_assignment_operator" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_additive_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_multiplicative_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_relational_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_logical_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_bitwise_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_shift_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_conditional_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_or_operator_multicatch" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_string_concatenation" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_assertion_message_operator" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.wrap_before_switch_case_arrow_operator" value="false"/>
```

**说明**:
- 赋值运算符换行时在旧行结尾
- 其他大部分运算符换行时在新行开头

**示例**:
```java
// 加法运算符在新行开头
int result = value1 + value2
        + value3
        + value4;

// 赋值运算符在旧行结尾
int x =
        computeValue();

// 条件运算符在新行开头
String result = condition
        ? "yes"
        : "no";

// 字符串连接在新行开头
String message = "Hello "
        + "World "
        + "!";

// Switch 箭头不换行
switch (value) {
    case 1 -> doSomething();
}
```

## 八、外层表达式换行

```xml
<setting id="org.eclipse.jdt.core.formatter.wrap_outer_expressions_when_nested" value="true"/>
```

**说明**: 当嵌套表达式时，外层表达式也会换行。

## 九、注释换行

### 9.1 注释行连接
```xml
<setting id="org.eclipse.jdt.core.formatter.join_wrapped_lines" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.join_lines_in_comments" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.join_line_comments" value="false"/>
```

**说明**:
- 普通代码行可以连接
- 注释内的行可以连接
- 单行注释不连接

## 十、总结

### 空行数量快速参考

| 位置 | 空行数 | 说明 |
|------|--------|------|
| package 前 | 0 | 文件开头 |
| package 后 | 1 | 与 import 分隔 |
| import 组间 | 0 | import 不分组 |
| import 后 | 1 | 与类声明分隔 |
| 类声明间 | 2 | 顶级类之间 |
| 字段前 | 0 | 字段紧凑排列 |
| 方法前 | 1 | 方法之间分隔 |
| 方法体开始 | 0 | 无空行 |
| 方法体结束 | 0 | 无空行 |
| 代码块前 | 0 | 无空行 |

### 换行规则快速参考

| 结构 | 换行规则 | 示例 |
|------|----------|------|
| else | 不换行 | `} else {` |
| catch | 不换行 | `} catch {` |
| finally | 不换行 | `} finally {` |
| while (do-while) | 不换行 | `} while` |
| 类型注解后 | 换行 | `@Entity\nclass` |
| 参数注解后 | 不换行 | `@NotNull String` |
| 文件结尾 | 换行 | 自动添加 |
| 运算符 | 在新行开头 | `+ value` |
| 赋值运算符 | 在旧行结尾 | `x =\n value` |

### 核心原则

1. ✅ **package 后 1 行空行**
2. ✅ **import 后 1 行空行**
3. ✅ **方法间 1 行空行**
4. ✅ **类型声明间 2 行空行**
5. ✅ **else/catch/finally 不换行**
6. ✅ **类型注解后换行**
7. ✅ **运算符在新行开头**
8. ✅ **文件结尾自动添加换行**

---

**上一篇**: [格式化配置说明-02-大括号和括号.md](./格式化配置说明-02-大括号和括号.md)  
**下一篇**: [格式化配置说明-04-注释格式化.md](./格式化配置说明-04-注释格式化.md)
