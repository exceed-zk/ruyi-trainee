# 格式化配置说明 - 06 其他配置

## 概述
本文档说明其他特殊的格式化配置项，共约 22 个配置。

## 一、文本块配置（Java 13+）

### 1.1 文本块缩进
```xml
<setting id="org.eclipse.jdt.core.formatter.text_block_indentation" value="0"/>
```

**说明**: 文本块内容不额外缩进（相对于开始位置）。

**示例**:
```java
String html = """
    <html>
        <body>
            <h1>Hello</h1>
        </body>
    </html>
    """;
// 文本块内容从基准位置开始，不额外缩进
```

## 二、制表符和空格配置

### 2.1 制表符使用
```xml
<setting id="org.eclipse.jdt.core.formatter.tabulation.char" value="space"/>
<setting id="org.eclipse.jdt.core.formatter.tabulation.size" value="4"/>
<setting id="org.eclipse.jdt.core.formatter.use_tabs_only_for_leading_indentations" value="false"/>
```

**说明**:
- 使用**空格**而非制表符
- 制表符大小等价于 4 个空格
- 不仅在前导缩进使用空格（所有位置都使用）

## 三、行长度配置

### 3.1 最大行长度
```xml
<setting id="org.eclipse.jdt.core.formatter.lineSplit" value="120"/>
<setting id="org.eclipse.jdt.core.formatter.comment.line_length" value="100"/>
```

**说明**:
- 代码最大行长度: **120 字符**
- 注释最大行长度: **100 字符**

## 四、空行保留

### 4.1 保留空行数量
```xml
<setting id="org.eclipse.jdt.core.formatter.number_of_empty_lines_to_preserve" value="3"/>
```

**说明**: 最多保留 3 行连续空行，超过的会被压缩。

**示例**:
```java
public void method1() {
}



public void method2() {     // 最多保留 3 行空行
}
```

## 五、括号和大括号后的空格

### 5.1 大括号后的空格
```xml
<setting id="org.eclipse.jdt.core.formatter.insert_space_after_closing_brace_in_block" value="insert"/>
```

**示例**:
```java
if (x > 0) { doSomething(); } else { doOther(); }
//         ^                ^      ^ 大括号后有空格
```

## 六、空语句配置

### 6.1 空语句换行
```xml
<setting id="org.eclipse.jdt.core.formatter.put_empty_statement_on_new_line" value="false"/>
```

**示例**:
```java
for (int i = 0; i < 10; i++);  // 空语句不换行
```

## 七、Keep 规则总结

### 7.1 保持在一行（如果为空）

以下结构如果为空，保持在一行：

```xml
<setting id="org.eclipse.jdt.core.formatter.keep_method_body_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_enum_constant_declaration_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_record_constructor_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_anonymous_type_declaration_on_one_line" value="one_line_if_empty"/>
```

**示例**:
```java
public void emptyMethod() { }       // 空方法一行
public MyClass() { }                // 空构造函数一行
Runnable r = new Runnable() { };   // 空匿名类一行（需要实现方法时除外）
```

### 7.2 从不保持在一行

以下结构即使很短也必须换行：

```xml
<setting id="org.eclipse.jdt.core.formatter.keep_type_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_enum_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_record_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_annotation_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_if_then_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_loop_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_code_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_lambda_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_switch_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_switch_case_with_arrow_on_one_line" value="one_line_never"/>
```

**示例**:
```java
// 所有这些都必须换行
public class A {
}

if (x > 0) {
    doSomething();
}

for (int i = 0; i < 10; i++) {
    process();
}
```

### 7.3 特殊的 Keep 规则

```xml
<setting id="org.eclipse.jdt.core.formatter.keep_simple_getter_setter_on_one_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_simple_for_body_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_simple_while_body_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_simple_do_while_body_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_then_statement_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_else_statement_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_empty_array_initializer_on_one_line" value="false"/>
```

**说明**: 即使很简单也不保持在同一行。

```xml
<setting id="org.eclipse.jdt.core.formatter.keep_imple_if_on_one_line" value="false"/>
```

**说明**: 简单的 if 语句不保持在一行（注：配置项名称可能是拼写错误"imple"而非"simple"）。

## 八、格式化控制

### 8.1 格式化开关标签
```xml
<setting id="org.eclipse.jdt.core.formatter.use_on_off_tags" value="true"/>
<setting id="org.eclipse.jdt.core.formatter.disabling_tag" value="@formatter:off"/>
<setting id="org.eclipse.jdt.core.formatter.enabling_tag" value="@formatter:on"/>
```

**使用示例**:
```java
// 正常格式化
int x = 1 + 2;

// @formatter:off
int[][]matrix={
{1,2,3},
{4,5,6}
};
// @formatter:on

// 恢复格式化
int y = 3 + 4;
```

## 九、特殊格式规则

### 9.1 else if 紧凑格式
```xml
<setting id="org.eclipse.jdt.core.formatter.compact_else_if" value="true"/>
```

**示例**:
```java
if (x > 10) {
    doSomething();
} else if (x > 5) {      // else if 在同一行
    doOther();
} else {
    doDefault();
}
```

### 9.2 Guardian 子句
```xml
<setting id="org.eclipse.jdt.core.formatter.format_guardian_clause_on_one_line" value="false"/>
```

**说明**: 守卫子句不保持在一行。

**示例**:
```java
// 正确
if (param == null) {
    return;
}

// 错误
if (param == null) return;
```

## 十、总结表格

### Keep 规则总结

| 规则值 | 含义 | 应用场景 |
|--------|------|---------|
| one_line_never | 从不保持一行 | 类声明、if/for/while 块、Lambda 块 |
| one_line_if_empty | 空时保持一行 | 空方法、空构造函数、空数组 |
| one_line_always | 总是保持一行 | 未使用 |
| one_line_if_single_item | 单项时保持一行 | 未使用 |

### 核心配置总结

| 配置项 | 值 | 说明 |
|--------|-----|------|
| 缩进字符 | space | 使用空格 |
| 缩进大小 | 4 | 4 个空格 |
| 代码行长度 | 120 | 最大 120 字符 |
| 注释行长度 | 100 | 最大 100 字符 |
| 保留空行 | 3 | 最多 3 行 |
| 格式化控制 | 启用 | @formatter:off/on |
| else if | 紧凑 | 在同一行 |
| 空方法 | 一行 | `{ }` |
| 代码块 | 必须换行 | 不保持一行 |

### 空格和换行快速参考

**使用空格的位置**:
- ✅ 运算符前后
- ✅ 逗号后
- ✅ 关键字后（if, while, for 等）
- ✅ 大括号前
- ✅ 类型转换后

**不使用空格的位置**:
- ❌ 括号内
- ❌ 逗号前
- ❌ 分号前
- ❌ 方法名和括号间
- ❌ 一元运算符前后

**必须换行的情况**:
- ✅ 类声明
- ✅ 方法体
- ✅ if/for/while 块
- ✅ Lambda 块体
- ✅ 类型注解后

**不换行的情况**:
- ❌ else/catch/finally 前
- ❌ 参数注解后
- ❌ 类型参数
- ❌ 简单表达式

## 十一、完整配置示例

### 理想的 Java 类格式

```java
/*
 * Copyright (c) 2025 ISCAS.
 *
 * SPDX-License-Identifier: EPL-2.0
 */
package com.example.demo;

import java.util.List;
import java.util.ArrayList;

/**
 * Example class demonstrating Google Java Style formatting.
 *
 * @author developer
 * @since 1.0
 */
public class ExampleClass extends BaseClass implements Interface1, Interface2 {
    
    private static final int MAX_SIZE = 100;
    private String name;
    private int age;
    
    /**
     * Constructor.
     *
     * @param name the name
     * @param age the age
     */
    public ExampleClass(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    /**
     * Processes the data with long parameter list.
     */
    public void processData(
            String longParameterName1,
            String longParameterName2,
            int parameterThree) {
        // 方法实现
        if (longParameterName1 != null) {
            doSomething();
        } else if (longParameterName2 != null) {
            doOther();
        } else {
            doDefault();
        }
    }
    
    /**
     * Method with long expression.
     */
    public int calculate() {
        return value1 + value2
                + value3
                + value4;
    }
    
    /**
     * Empty method.
     */
    public void emptyMethod() { }
}
```

---

**上一篇**: [格式化配置说明-05-对齐和换行策略.md](./格式化配置说明-05-对齐和换行策略.md)  
**返回**: [格式化配置说明-00-总体概览.md](./格式化配置说明-00-总体概览.md)

---

**文档系列完成**

共创建 7 个文档，涵盖 Eclipse Java Google Style 格式化配置的全部 402 个配置项：

1. ✅ 总体概览 - 配置文件介绍和导航
2. ✅ 缩进和空格 - 约 180 个配置项
3. ✅ 大括号和括号 - 约 40 个配置项
4. ✅ 换行和空行 - 约 60 个配置项
5. ✅ 注释格式化 - 约 20 个配置项
6. ✅ 对齐和换行策略 - 约 80 个配置项
7. ✅ 其他配置 - 约 22 个配置项
