# 格式化配置说明 - 02 大括号和括号

## 概述
本文档详细说明与**大括号和括号位置**相关的配置项，共约 40 个配置。

## 一、大括号位置配置

### 1.1 统一规则
所有大括号位置配置值均为 **`end_of_line`**（行尾），符合 **K&R 风格**（Google Java Style）。

### 1.2 类型声明
```xml
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_type_declaration" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_enum_declaration" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_annotation_type_declaration" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_record_declaration" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_anonymous_type_declaration" value="end_of_line"/>
```

**示例**:
```java
public class MyClass {         // 大括号在行尾
    // 类体
}

public enum Status {           // 枚举大括号在行尾
    ACTIVE, INACTIVE
}

public @interface MyAnnotation {  // 注解大括号在行尾
}

public record Point(int x, int y) {  // 记录大括号在行尾
}

Runnable r = new Runnable() {  // 匿名类大括号在行尾
    public void run() { }
};
```

### 1.3 方法和构造函数
```xml
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_method_declaration" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_constructor_declaration" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_record_constructor" value="end_of_line"/>
```

**示例**:
```java
public void myMethod() {       // 方法大括号在行尾
    // 方法体
}

public MyClass() {             // 构造函数大括号在行尾
    // 构造函数体
}
```

### 1.4 代码块
```xml
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_block" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_block_in_case" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_block_in_case_after_arrow" value="end_of_line"/>
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_lambda_body" value="end_of_line"/>
```

**示例**:
```java
if (condition) {               // if 大括号在行尾
    // 代码
}

switch (value) {
    case 1: {                  // case 块大括号在行尾
        break;
    }
    case 2 -> {                // 箭头 case 大括号在行尾
        doSomething();
    }
}

list.forEach(item -> {         // Lambda 大括号在行尾
    process(item);
});
```

### 1.5 Switch 语句
```xml
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_switch" value="end_of_line"/>
```

**示例**:
```java
switch (value) {               // switch 大括号在行尾
    case 1:
        break;
    default:
        break;
}
```

### 1.6 数组初始化
```xml
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_array_initializer" value="end_of_line"/>
```

**示例**:
```java
int[] array = {1, 2, 3};       // 数组初始化大括号在行尾

int[][] matrix = {             // 多维数组大括号在行尾
    {1, 2},
    {3, 4}
};
```

### 1.7 枚举常量
```xml
<setting id="org.eclipse.jdt.core.formatter.brace_position_for_enum_constant" value="end_of_line"/>
```

**示例**:
```java
public enum Status {
    ACTIVE {                   // 枚举常量大括号在行尾
        @Override
        public void process() { }
    },
    INACTIVE {
        @Override
        public void process() { }
    }
}
```

## 二、括号位置配置

### 2.1 括号位置策略
配置值 **`common_lines`** 表示括号根据常规规则放置（通常保持在同一行，除非行太长）。

### 2.2 方法相关括号
```xml
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_method_delcaration" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_method_invocation" value="common_lines"/>
```

**示例**:
```java
// 方法声明括号
public void method(String param1, int param2) {
}

// 参数较多时可能换行
public void longMethod(
        String veryLongParameterName1,
        String veryLongParameterName2) {
}

// 方法调用括号
result = method(arg1, arg2);
```

### 2.3 控制语句括号
```xml
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_if_while_statement" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_for_statment" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_switch_statement" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_catch_clause" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_try_clause" value="common_lines"/>
```

**示例**:
```java
if (condition) { }
while (condition) { }
for (int i = 0; i < 10; i++) { }
switch (value) { }
try (Resource r = getResource()) { }
catch (Exception e) { }
```

### 2.4 其他括号
```xml
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_annotation" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_enum_constant_declaration" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_record_declaration" value="common_lines"/>
<setting id="org.eclipse.jdt.core.formatter.parentheses_positions_in_lambda_declaration" value="common_lines"/>
```

**示例**:
```java
@SuppressWarnings("unchecked")     // 注解括号
public enum Color {
    RED(255, 0, 0),                // 枚举常量括号
    GREEN(0, 255, 0)
}

public record Point(int x, int y) { }  // 记录括号

list.stream().filter((item) -> item > 0)  // Lambda 括号
```

## 三、保持在一行的规则

### 3.1 空声明保持一行
```xml
<setting id="org.eclipse.jdt.core.formatter.keep_method_body_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_enum_constant_declaration_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_record_constructor_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_anonymous_type_declaration_on_one_line" value="one_line_if_empty"/>
<setting id="org.eclipse.jdt.core.formatter.keep_empty_array_initializer_on_one_line" value="false"/>
```

**示例**:
```java
public void emptyMethod() { }     // 空方法保持一行

public MyClass() { }              // 空构造函数保持一行

int[] empty = {};                 // 空数组保持一行
```

### 3.2 从不保持在一行
```xml
<setting id="org.eclipse.jdt.core.formatter.keep_type_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_enum_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_record_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_annotation_declaration_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_if_then_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_loop_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_code_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_lambda_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_switch_body_block_on_one_line" value="one_line_never"/>
<setting id="org.eclipse.jdt.core.formatter.keep_switch_case_with_arrow_on_one_line" value="one_line_never"/>
```

**说明**: 这些结构即使很短也不保持在一行，必须换行。

**示例**:
```java
// 类声明不保持在一行
public class MyClass {
}

// if 语句块不保持在一行
if (condition) {
    doSomething();
}

// Lambda 块不保持在一行
list.forEach(item -> {
    process(item);
});
```

### 3.3 特殊情况
```xml
<setting id="org.eclipse.jdt.core.formatter.keep_simple_getter_setter_on_one_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_simple_for_body_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_simple_while_body_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_simple_do_while_body_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_then_statement_on_same_line" value="false"/>
<setting id="org.eclipse.jdt.core.formatter.keep_else_statement_on_same_line" value="false"/>
```

**说明**: 即使是简单的 getter/setter 或单行循环体，也不保持在同一行。

**示例**:
```java
// Getter 不保持在一行（即使很简单）
public String getName() {
    return name;
}

// 循环体不保持在同一行
for (int i = 0; i < 10; i++) {
    doSomething();
}

// if 语句不保持在同一行
if (condition) {
    doSomething();
}
```

## 四、特殊大括号规则

### 4.1 else if 紧凑格式
```xml
<setting id="org.eclipse.jdt.core.formatter.compact_else_if" value="true"/>
```

**示例**:
```java
// 正确: else if 紧凑格式
if (x > 10) {
    doSomething();
} else if (x > 5) {     // else if 在同一行
    doOther();
} else {
    doDefault();
}

// 错误: 不紧凑
if (x > 10) {
    doSomething();
} else
    if (x > 5) {        // else 和 if 分开
        doOther();
    }
```

### 4.2 空语句
```xml
<setting id="org.eclipse.jdt.core.formatter.put_empty_statement_on_new_line" value="false"/>
```

**示例**:
```java
// 空语句不换行
for (int i = 0; i < 10; i++);  // 正确（虽然不推荐空循环）
```

### 4.3 Guardian 子句
```xml
<setting id="org.eclipse.jdt.core.formatter.format_guardian_clause_on_one_line" value="false"/>
```

**说明**: 守卫子句不保持在一行。

**示例**:
```java
// 守卫子句换行
if (param == null) {
    return;
}

// 而不是
if (param == null) return;  // 不推荐
```

## 五、总结

### 核心规则

1. ✅ **所有大括号在行尾** (K&R 风格)
2. ✅ **大括号前插入空格**
3. ✅ **空方法/构造函数保持一行** `{ }`
4. ✅ **非空结构必须换行**，不保持在一行
5. ✅ **括号使用 common_lines 策略**
6. ✅ **else if 使用紧凑格式**

### 大括号位置对照表

| 结构类型 | 大括号位置 | 示例 |
|---------|----------|------|
| 类声明 | end_of_line | `class A {` |
| 方法声明 | end_of_line | `void m() {` |
| 构造函数 | end_of_line | `A() {` |
| 枚举 | end_of_line | `enum E {` |
| 注解 | end_of_line | `@interface A {` |
| Record | end_of_line | `record R() {` |
| 代码块 | end_of_line | `if (x) {` |
| Lambda | end_of_line | `() -> {` |
| Switch | end_of_line | `switch (x) {` |
| 数组初始化 | end_of_line | `int[] a = {` |

### 保持一行规则对照表

| 结构类型 | 规则 | 说明 |
|---------|-----|------|
| 空方法体 | one_line_if_empty | `void m() { }` 可以一行 |
| 空构造函数 | one_line_if_empty | `A() { }` 可以一行 |
| 非空方法 | one_line_never | 必须换行 |
| 类声明 | one_line_never | 必须换行 |
| if 块 | one_line_never | 必须换行 |
| 循环块 | one_line_never | 必须换行 |
| Lambda 块 | one_line_never | 必须换行 |

---

**上一篇**: [格式化配置说明-01-缩进和空格.md](./格式化配置说明-01-缩进和空格.md)  
**下一篇**: [格式化配置说明-03-换行和空行.md](./格式化配置说明-03-换行和空行.md)
