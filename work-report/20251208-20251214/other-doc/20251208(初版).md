# **20251208：**

#### 修复 Maven 编译器版本错误（不管的话也能成功编译）

**问题：**

- Maven 构建报错："Java: 错误: 不支持发行版本 5"
- 提示："javac 21 仅于 java 源"

**原因分析：**

- 虽然在 IDEA 中设置了语言版本 21
- 但 Maven 构建使用自己的编译器配置
- 根 pom.xml 中缺少 Java 版本配置

**解决步骤：**

1. **编辑根 pom.xml**：

   - 文件路径：`d:/ruyiSDK/plugins/ruyisdk-eclipse-plugins/pom.xml`

2. **在 `<properties>` 节点添加**：

   ```xml
   <!-- Java version configuration -->
   <maven.compiler.source>17</maven.compiler.source>
   <maven.compiler.target>17</maven.compiler.target>
   <maven.compiler.release>17</maven.compiler.release>
   ```

3. **选择 Java 17 的原因**：

   - 所有插件的 MANIFEST.MF 中指定的是 `JavaSE-17`
   - Eclipse 2025-09 完全支持 Java 17
   - 保持与 OSGi bundle 要求一致

4. **刷新配置或者重启IDEA**：

   - 在 IDEA 中：右键项目 → Maven → Reload Project
   - 或点击 Maven 工具窗口的刷新图标

5. **验证修复**：

   ```bash
   mvn clean verify
   ```

   - ✅ 构建成功，不再报 Java 版本错误

**配置说明：**

- `maven.compiler.source`：源代码兼容级别
- `maven.compiler.target`：生成的 class 文件兼容级别
- `maven.compiler.release`：确保 API 兼容性

#### 关于类中报错的说明

**三种环境的依赖解析方式：**

| 环境             | 依赖解析方式     | 结果                         |
| ---------------- | ---------------- | ---------------------------- |
| IDEA 编辑器      | Maven classpath  | ❌ 报错（找不到 Eclipse API） |
| Maven/Tycho 构建 | OSGi MANIFEST.MF | ✅ 成功                       |
| Eclipse 运行时   | OSGi bundle 依赖 | ✅ 成功                       |

**为什么不影响启动和运行：**

1. **构建阶段**：
   - Maven 使用 Tycho 插件
   - Tycho 读取 MANIFEST.MF 的 Require-Bundle
   - 从 Eclipse P2 仓库解析依赖
   - 生成正确的 jar 包

2. **运行阶段**：
   - Eclipse Application 使用编译好的 jar 包
   - OSGi 运行时负责加载所有 bundles
   - 依赖关系由 OSGi 解析和管理

3. **IDEA 编辑器**：
   - 只能通过 Maven classpath 查找类
   - 无法理解 OSGi 的 bundle 依赖机制
   - 因此显示错误，但不影响实际构建

**改善方案（可选）：**

1. **方案 1：手动添加 Eclipse 库**
   - `File → Project Structure → Libraries`
   - 添加 Eclipse plugins 目录下的 jar 包
   - 缺点：手动维护，可能不同步

2. **方案 2：接受现状**
   - 专注于功能开发
   - 依赖 Maven 构建验证
   - 在运行时测试
   - 忽略编辑器的误报

---

### 总结：在 IDEA 中开发 Eclipse 插件的完整配置

#### 必需插件

- **Eclipse PDE Partial**：编辑器增强 + 本地运行配置

#### 核心配置步骤

1. **Eclipse Target 配置**
   - 添加 Eclipse 安装路径
   - 添加项目构建输出（可选）

2. **模块 Facet 配置**
   - 为 plugins 模块添加 Eclipse PDE Partial Facet
   - 勾选所有插件子模块

3. **Maven 编译器配置**
   - 在 pom.xml 中指定 Java 17
   - 与 MANIFEST.MF 保持一致

4. **运行配置**
   - 创建 Eclipse Application Partial 配置
   - 正确设置 Application 为 org.eclipse.ui.ide.workbench
   - 配置 VM options 和 program arguments

#### 已知限制和解决方案

1. **类中报错**
   - 现象：Eclipse API 显示找不到
   - 原因：IDEA 无法完全解析 OSGi 依赖
   - 解决：手动添加 Eclipse 库
2. **需要重新构建才能看到修改**
   - 原因：插件从 jar 包加载，不是 .class 文件
   - 解决：使用 `mvn clean package` 快速构建（30-60秒）
3. **调试功能**
   - 可用：断点、单步执行、变量查看、调用栈
   - 结构修改需要重启 Eclipse

# 20251209：

搞清楚了jclasslib是如何使用的

商讨了一下关于补全插件的要求

开始VScode的配置

发现idea中索引容易丢失