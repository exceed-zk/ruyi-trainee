# Eclipse Java Google Style 格式化配置 - 总体概览

## 文档说明

此配置文件 `ruyisdk-eclipse-java-google-style.xml` 是基于 **Google Java Style Guide** 的 Eclipse 代码格式化器配置文件，包含 **402 个详细配置项**，全面控制 Java 代码的自动格式化行为。

## 配置文件基本信息

- **配置名称**: GoogleStyle
- **配置版本**: 23（Eclipse 格式化器版本）
- **配置类型**: CodeFormatterProfile
- **文件格式**: XML
- **配置项总数**: 402 个 setting

## 核心配置参数

### 基础设置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **indentation.size** | 4 | 缩进大小为 4 个空格 |
| **tabulation.char** | space | 使用空格而非制表符 |
| **tabulation.size** | 4 | 制表符大小为 4 |
| **lineSplit** | 120 | 最大行长度为 120 字符 |
| **continuation_indentation** | 4 | 续行缩进为 4 个空格 |

### 大括号位置（统一为行尾）

所有大括号位置配置值均为 **`end_of_line`**：
- 类声明
- 方法声明
- 构造函数
- 枚举声明
- 注解声明
- 匿名类
- Lambda 表达式
- Switch 语句
- 代码块

### 格式化控制标签

| 标签 | 说明 |
|------|------|
| **@formatter:off** | 关闭格式化 |
| **@formatter:on** | 开启格式化 |
| **use_on_off_tags** | true - 启用格式化控制标签 |

## 配置分类导航

为便于理解和查阅，我们将 402 个配置项分为以下 6 大类：

### 📏 1. 缩进和空格配置（约 180 项）
**文档**: `格式化配置说明-01-缩进和空格.md`

控制空格的插入位置，包括：
- 运算符前后的空格
- 逗号、分号前后的空格
- 括号内外的空格
- 关键字后的空格
- 类型参数的空格
- 数组、泛型的空格

**关键配置示例**:
- 赋值运算符后插入空格
- 逗号后插入空格
- 括号内不插入空格
- 方法名和括号间不插入空格

### 🔲 2. 大括号和括号配置（约 40 项）
**文档**: `格式化配置说明-02-大括号和括号.md`

控制大括号和括号的位置，包括：
- 大括号位置（类、方法、代码块等）
- 括号位置（方法调用、条件语句等）
- 空括号的处理
- 括号内的空格

**关键配置示例**:
- 所有大括号在行尾（end_of_line）
- 括号内不加空格
- 空方法保持 `{}`

### 📐 3. 换行和空行配置（约 60 项）
**文档**: `格式化配置说明-03-换行和空行.md`

控制换行和空行的使用，包括：
- 注解后的换行
- 关键字前的换行
- 空行的数量
- 语句保持在同一行的规则

**关键配置示例**:
- package 后 1 个空行
- import 后 1 个空行
- 方法间 1 个空行
- 类型声明间 2 个空行

### 💬 4. 注释格式化配置（约 20 项）
**文档**: `格式化配置说明-04-注释格式化.md`

控制注释的格式化行为，包括：
- JavaDoc 注释格式化
- 块注释格式化
- 行注释格式化
- 注释行长度限制

**关键配置示例**:
- JavaDoc 最大行长度 100
- 代码最大行长度 120
- 格式化 HTML 标签
- 标签不对齐

### 🎯 5. 对齐和换行策略配置（约 80 项）
**文档**: `格式化配置说明-05-对齐和换行策略.md`

控制代码对齐和自动换行策略，包括：
- 方法参数对齐
- 方法调用参数对齐
- 运算符换行位置
- 表达式换行策略

**关键配置示例**:
- 运算符在新行开头
- 参数过长时换行
- 不进行列对齐
- 紧凑的 else if

### 🔧 6. 其他特殊配置（约 22 项）
**文档**: `格式化配置说明-06-其他配置.md`

其他特殊配置，包括：
- 保持单行的规则
- 文本块缩进
- 空语句处理
- 保留空行数量

## 配置值说明

### 布尔值配置
- **true** / **false**: 启用或禁用某个特性

### 空格配置
- **insert**: 插入空格
- **do not insert**: 不插入空格

### 换行配置
- **insert**: 插入换行
- **do not insert**: 不插入换行

### 大括号位置
- **end_of_line**: 在行尾（Google Style 统一使用）
- **next_line**: 在新行
- **next_line_shifted**: 在新行并缩进
- **next_line_on_wrap**: 换行时在新行

### 括号位置
- **common_lines**: 常规行处理
- **separate_lines**: 分离到独立行
- **preserve_positions**: 保持原有位置

### 单行保持规则
- **one_line_never**: 从不保持在一行
- **one_line_if_empty**: 仅在空时保持一行
- **one_line_always**: 总是保持在一行
- **one_line_if_single_item**: 仅一项时保持一行

### 对齐策略值
对齐配置使用数字表示策略组合：
- **0**: 不换行
- **16**: 必要时换行，每个元素独立一行
- **48**: 换行时第一个元素也独立一行
- **49**: 强制换行，所有元素独立一行
- **80**: 条件表达式特殊换行

## 使用方法

### 在 Eclipse 中导入

1. **打开首选项**
   ```
   Window → Preferences → Java → Code Style → Formatter
   ```

2. **导入配置文件**
   - 点击 "Import..." 按钮
   - 选择 `ruyisdk-eclipse-java-google-style.xml`
   - 配置名称显示为 "GoogleStyle"

3. **激活配置**
   - 选中 "GoogleStyle" 配置
   - 点击 "Apply and Close"

4. **应用到项目**
   - 右键项目 → Properties
   - Java Code Style → Formatter
   - 勾选 "Enable project specific settings"
   - 选择 "GoogleStyle"

### 格式化代码

- **格式化当前文件**: `Ctrl + Shift + F` (Windows/Linux) 或 `Cmd + Shift + F` (Mac)
- **格式化选中代码**: 选中代码后按格式化快捷键
- **保存时自动格式化**: Preferences → Java → Editor → Save Actions

### 使用格式化控制标签

在代码中使用注释控制格式化：

```java
// @formatter:off
int[][] matrix = {
    {1,  2,  3},
    {10, 20, 30},
    {100,200,300}
};
// @formatter:on
```

## 与 Google Java Style Guide 的关系

此配置文件严格遵循 **Google Java Style Guide**：

### 核心特征

1. ✅ **缩进**: 4 个空格（+4）
2. ✅ **行长度**: 最大 120 字符
3. ✅ **大括号**: K&R 风格（行尾）
4. ✅ **空格**: 使用空格，禁用制表符
5. ✅ **续行缩进**: 4 个空格（+4）

### Google Style 关键规则

- **大括号必须使用**: 即使只有一条语句
- **大括号在行尾**: K&R 风格
- **4 空格缩进**: 不使用制表符
- **120 字符行限制**: 代码最长 120，注释最长 100
- **列不对齐**: 避免列对齐以减少维护成本
- **运算符在行首**: 换行时运算符在新行开头

## 常见配置场景

### 场景 1: 方法声明格式

**配置效果**:
```java
public void myMethod(String param1, int param2) {
    // 方法体
}
```

**相关配置**:
- `brace_position_for_method_declaration` = `end_of_line`
- `insert_space_before_opening_brace_in_method_declaration` = `insert`
- `insert_space_before_opening_paren_in_method_declaration` = `do not insert`

### 场景 2: 条件语句格式

**配置效果**:
```java
if (condition) {
    doSomething();
} else {
    doOtherthing();
}
```

**相关配置**:
- `insert_space_before_opening_paren_in_if` = `insert`
- `insert_new_line_before_else_in_if_statement` = `do not insert`
- `compact_else_if` = `true`

### 场景 3: 运算符换行

**配置效果**:
```java
int result = value1 + value2
        + value3
        + value4;
```

**相关配置**:
- `wrap_before_additive_operator` = `true`
- `alignment_for_additive_operator` = `16`
- `insert_space_before_additive_operator` = `insert`

## 验证和测试

### 验证配置是否生效

创建测试文件并格式化：

```java
public class FormatTest{
private int x;
public void test(  ){
if(x>0){System.out.println("test");}
}
}
```

格式化后应该变为：

```java
public class FormatTest {
    private int x;

    public void test() {
        if (x > 0) {
            System.out.println("test");
        }
    }
}
```

### 常见问题排查

1. **格式化无效**: 检查是否启用了项目特定设置
2. **格式化被覆盖**: 检查保存操作中的格式化设置
3. **部分不格式化**: 检查是否有 `@formatter:off` 标签

## 与其他配置文件的配合

### 配套文件

此格式化配置应该与以下文件配合使用：

1. **Checkstyle 配置**: `ruyisdk_ide_google_checks.xml`
   - 静态代码检查
   - 验证格式化结果

2. **代码模板配置**: `ruyisdk-eclipse-java-codetemplates.xml`
   - 自动生成代码注释
   - 文件头版权声明

### 工作流程

```
编写代码 → 自动格式化 → Checkstyle 检查 → 通过验证
    ↑          ↓                ↓              ↓
  模板生成  ← 格式规范 ←    代码检查    →    提交代码
```

## 后续文档

请查阅以下详细文档了解具体配置：

1. 📏 **[格式化配置说明-01-缩进和空格.md](./格式化配置说明-01-缩进和空格.md)** - 约 180 个配置项
2. 🔲 **[格式化配置说明-02-大括号和括号.md](./格式化配置说明-02-大括号和括号.md)** - 约 40 个配置项
3. 📐 **[格式化配置说明-03-换行和空行.md](./格式化配置说明-03-换行和空行.md)** - 约 60 个配置项
4. 💬 **[格式化配置说明-04-注释格式化.md](./格式化配置说明-04-注释格式化.md)** - 约 20 个配置项
5. 🎯 **[格式化配置说明-05-对齐和换行策略.md](./格式化配置说明-05-对齐和换行策略.md)** - 约 80 个配置项
6. 🔧 **[格式化配置说明-06-其他配置.md](./格式化配置说明-06-其他配置.md)** - 约 22 个配置项

---

**文档生成时间**: 2025年11月  
**适用版本**: Eclipse 4.6+, Java 8+  
**基于规范**: Google Java Style Guide
