# 格式化配置说明 - 05 对齐和换行策略

## 概述
本文档详细说明与**对齐和换行策略**相关的配置项，共约 80 个配置。这些配置控制当代码行过长时如何换行和对齐。

## 一、对齐策略值说明

对齐配置使用数字值表示不同的换行策略：

| 值 | 策略 | 说明 |
|----|------|------|
| **0** | 不换行 | 所有元素保持在一行 |
| **16** | 必要时换行，元素独立 | 每个元素独立一行 |
| **48** | 换行时首元素也独立 | 首元素也独立一行 |
| **49** | 强制换行 | 总是换行，所有元素独立 |
| **80** | 特殊条件换行 | 用于条件表达式 |

## 二、方法相关对齐

### 2.1 方法参数
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_parameters_in_method_declaration" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_parameters_in_constructor_declaration" value="16"/>
```

**策略 16**: 参数过长时换行，每个参数独立一行。

**示例**:
```java
// 短参数列表
public void method(int a, int b) {
}

// 长参数列表换行
public void methodWithLongParameters(
        String veryLongParameterName1,
        String veryLongParameterName2,
        int parameterThree) {
}
```

### 2.2 方法调用参数
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_arguments_in_method_invocation" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_arguments_in_explicit_constructor_call" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_arguments_in_qualified_allocation_expression" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_arguments_in_allocation_expression" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_arguments_in_enum_constant" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_arguments_in_annotation" value="16"/>
```

**示例**:
```java
// 短参数
result = method(a, b, c);

// 长参数换行
result = method(
        veryLongArgumentName1,
        veryLongArgumentName2,
        veryLongArgumentName3);
```

### 2.3 方法声明和选择器
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_method_declaration" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_selector_in_method_invocation" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.align_selector_in_method_invocation_on_expression_first_line" value="false"/>
```

**示例**:
```java
// 方法链调用
result = object.method1()
        .method2()
        .method3();
```

## 三、类型相关对齐

### 3.1 类型声明
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_superclass_in_type_declaration" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_type_declaration" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_enum_declaration" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_superinterfaces_in_record_declaration" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_permitted_types_in_type_declaration" value="16"/>
```

**示例**:
```java
// 继承和实现
public class MyClass
        extends BaseClass
        implements Interface1, Interface2 {
}

// 密封类
public sealed class Shape
        permits Circle, Square {
}
```

### 3.2 类型参数
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_type_parameters" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_type_arguments" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_parameterized_type_references" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_type_annotations" value="0"/>
```

**说明**: 类型参数不换行，保持紧凑。

**示例**:
```java
public class MyClass<T extends Comparable<T>> {
    Map<String, List<Integer>> map;
}
```

## 四、运算符对齐

### 4.1 二元运算符
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_additive_operator" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_multiplicative_operator" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_logical_operator" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_bitwise_operator" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_relational_operator" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_shift_operator" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_string_concatenation" value="16"/>
```

**示例**:
```java
// 加法运算符换行
int result = value1 + value2
        + value3
        + value4;

// 逻辑运算符换行
if (condition1 && condition2
        && condition3
        || condition4) {
}

// 字符串连接换行
String message = "Hello "
        + "World "
        + "from "
        + "Java";
```

### 4.2 赋值运算符
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_assignment" value="16"/>
```

**示例**:
```java
int veryLongVariableName =
        computeValue();
```

## 五、表达式对齐

### 5.1 条件表达式
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_conditional_expression" value="80"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_conditional_expression_chain" value="0"/>
```

**策略 80**: 条件表达式特殊换行。

**示例**:
```java
String result = condition
        ? "value1"
        : "value2";

// 链式条件不换行
String result = (x > 0) ? "positive" : (x < 0) ? "negative" : "zero";
```

### 5.2 数组初始化
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_expressions_in_array_initializer" value="16"/>
```

**示例**:
```java
// 简单数组
int[] arr = {1, 2, 3};

// 复杂数组换行
String[] names = {
        "Alice",
        "Bob",
        "Charlie"
};
```

### 5.3 Switch 表达式
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_expressions_in_switch_case_with_arrow" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_expressions_in_switch_case_with_colon" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_switch_case_with_arrow" value="0"/>
```

**说明**: Switch 表达式不换行。

### 5.4 for 循环表达式
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_expressions_in_for_loop_header" value="0"/>
```

**示例**:
```java
for (int i = 0; i < 10; i++) {  // for 头不换行
}
```

## 六、注解对齐

### 6.1 强制换行的注解
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_type" value="49"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_field" value="49"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_method" value="49"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_local_variable" value="49"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_package" value="49"/>
```

**策略 49**: 强制换行，每个注解独立一行。

**示例**:
```java
@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue
    private Long id;
    
    @Override
    @Transactional
    public void method() {
    }
}
```

### 6.2 不换行的注解
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_parameter" value="0"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_annotations_on_enum_constant" value="0"/>
```

**示例**:
```java
public void method(@NotNull @Valid String param) {  // 参数注解不换行
}

public enum Status {
    @Deprecated OLD_STATUS  // 枚举常量注解不换行
}
```

## 七、其他对齐配置

### 7.1 throws 子句
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_throws_clause_in_method_declaration" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_throws_clause_in_constructor_declaration" value="16"/>
```

**示例**:
```java
public void method()
        throws IOException,
        SQLException {
}
```

### 7.2 Record 组件
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_record_components" value="16"/>
```

**示例**:
```java
public record Person(
        String firstName,
        String lastName,
        int age) {
}
```

### 7.3 模块语句
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_module_statements" value="16"/>
```

**示例**:
```java
module my.module {
    requires java.base;
    exports com.example.api;
}
```

### 7.4 try-with-resources
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_resources_in_try" value="80"/>
```

**示例**:
```java
try (BufferedReader reader = new BufferedReader(new FileReader("file.txt"));
        BufferedWriter writer = new BufferedWriter(new FileWriter("out.txt"))) {
    // code
}
```

### 7.5 多字段声明
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_multiple_fields" value="16"/>
```

**说明**: 建议每行声明一个字段。

### 7.6 紧凑循环和 if
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_compact_loops" value="16"/>
<setting id="org.eclipse.jdt.core.formatter.alignment_for_compact_if" value="16"/>
```

### 7.7 断言消息
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_assertion_message" value="0"/>
```

**示例**:
```java
assert condition : "Error message";  // 断言消息不换行
```

### 7.8 多重 catch
```xml
<setting id="org.eclipse.jdt.core.formatter.alignment_for_union_type_in_multicatch" value="16"/>
```

**示例**:
```java
try {
    // code
} catch (IOException | SQLException e) {  // 简短时不换行
    // handle
}

try {
    // code
} catch (FileNotFoundException
        | SocketException
        | TimeoutException e) {  // 过长时换行
    // handle
}
```

## 八、字段和箭头对齐

### 8.1 不使用列对齐
```xml
<setting id="org.eclipse.jdt.core.formatter.align_fields_grouping_blank_lines" value="2147483647"/>
<setting id="org.eclipse.jdt.core.formatter.align_arrows_in_switch_on_columns" value="false"/>
```

**说明**: 
- 不对齐字段声明
- Switch 箭头不列对齐

**示例**:
```java
// 正确: 不对齐
private int x;
private String name;
private List<String> list;

// 错误: 列对齐（不推荐）
private int          x;
private String       name;
private List<String> list;
```

## 九、总结

### 对齐策略快速参考

| 配置项 | 策略值 | 换行规则 |
|--------|-------|----------|
| 方法参数 | 16 | 必要时每个独立一行 |
| 方法调用参数 | 16 | 必要时每个独立一行 |
| 继承和实现 | 16 | 每个接口独立一行 |
| 类型参数 | 0 | 不换行 |
| 运算符 | 16 | 必要时换行 |
| 条件表达式 | 80 | 特殊换行 |
| 类型注解 | 49 | 强制换行 |
| 参数注解 | 0 | 不换行 |

### 核心原则

1. ✅ **方法参数过长时换行**，每个参数独立
2. ✅ **运算符换行时在新行开头**
3. ✅ **类型注解强制换行**
4. ✅ **不使用列对齐**
5. ✅ **类型参数保持紧凑**
6. ✅ **方法链换行对齐**

### 典型换行示例

```java
// 方法参数换行
public void method(
        String param1,
        int param2,
        boolean param3) {
}

// 运算符换行
int result = value1 + value2
        + value3
        + value4;

// 方法链换行
result = list.stream()
        .filter(x -> x > 0)
        .map(x -> x * 2)
        .collect(Collectors.toList());

// 类型声明换行
public class MyClass
        extends BaseClass
        implements Interface1, Interface2 {
}

// 注解换行
@Override
@Transactional
public void method() {
}
```

---

**上一篇**: [格式化配置说明-04-注释格式化.md](./格式化配置说明-04-注释格式化.md)  
**下一篇**: [格式化配置说明-06-其他配置.md](./格式化配置说明-06-其他配置.md)
