# RuyiSDK Eclipse 插件 - 自动更新功能说明

## 📝 您的问题解答

### ❓ 问题 1: 使用 GitHub Pages 和 GitHub Actions 是否已经能实现用户对于插件的更新自动通知？

**回答**: **基本可以，但有限制**

✅ **已经实现的功能：**
1. ✅ **远程更新站点**：通过 GitHub Pages 托管 P2 更新站点
2. ✅ **自动发布**：GitHub Actions 自动构建并发布到 GitHub Pages
3. ✅ **版本检测**：Eclipse 可以检测到新版本
4. ✅ **后台更新检查**：Eclipse 可以在后台定期检查更新

⚠️ **限制和注意事项：**
1. ⚠️ **不会主动弹窗通知**：Eclipse 不会像手机 App 那样主动弹窗告诉用户有新版本
2. ⚠️ **需要用户配置**：用户需要在 Eclipse 中启用"自动检查更新"功能
3. ⚠️ **被动通知**：Eclipse 只会在状态栏显示更新图标，不会强制通知

**工作原理：**
```
开发者发布新版本
    ↓
GitHub Actions 自动构建
    ↓
发布到 GitHub Pages (P2 更新站点)
    ↓
用户的 Eclipse IDE 定期检查更新站点
    ↓
发现新版本时，在状态栏显示更新图标 🔄
    ↓
用户点击图标安装更新
```

---

### ❓ 问题 2: 需要在 GitHub 上准备什么才能实现远程更新？

**回答**: **需要完成以下配置**

## 🔧 GitHub 必需配置清单

### 1️⃣ **启用 GitHub Pages** ⭐ 最重要

在您的 GitHub 仓库中：

1. 进入 `Settings` → `Pages`
2. **Source**: 选择 `Deploy from a branch`
3. **Branch**: 选择 `gh-pages` 分支
4. **Folder**: 选择 `/ (root)`
5. 点击 `Save`

**结果：** 您的更新站点将可以通过以下 URL 访问：
```
https://[您的GitHub用户名].github.io/ruyisdk-eclipse-plugins/
```

### 2️⃣ **配置 GitHub Actions 权限**

在 `Settings` → `Actions` → `General`:

1. **Workflow permissions**: 选择 `Read and write permissions`
2. 勾选 ☑ `Allow GitHub Actions to create and approve pull requests`
3. 点击 `Save`

### 3️⃣ **确认 Workflow 文件已存在** ✅ 您已经有了

您的仓库已经有以下 workflow 文件：
- ✅ `.github/workflows/build-and-publish-p2.yml` - 自动构建并发布到 GitHub Pages
- ✅ `.github/workflows/release.yml` - 创建 GitHub Release

### 4️⃣ **版本管理流程**

每次发布新版本时：

```bash
# 步骤 1: 更新版本号
.\update-version.ps1 0.0.5   # Windows
# 或
./update-version.sh 0.0.5    # Linux/macOS

# 步骤 2: 构建测试
mvn clean verify

# 步骤 3: 提交代码
git add .
git commit -m "chore: bump version to 0.0.5"
git push origin main

# 步骤 4: 创建 Release Tag
git tag v0.0.5
git push origin v0.0.5
```

**自动化流程：**
1. 推送到 main 分支 → 触发 `build-and-publish-p2.yml` → 发布到 GitHub Pages
2. 推送 tag → 触发 `release.yml` → 创建 GitHub Release

---

## 📊 完整架构图

```
┌─────────────────────────────────────────────────────────────┐
│                     开发者端                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 更新代码 + 版本号                                         │
│     ↓                                                        │
│  2. 提交到 GitHub (main 分支)                                 │
│     ↓                                                        │
│  3. 创建 Tag (v0.0.x)                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                  GitHub Actions (自动)                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  • build-and-publish-p2.yml                                 │
│    - 构建 P2 仓库                                            │
│    - 发布到 GitHub Pages (gh-pages 分支)                     │
│                                                             │
│  • release.yml                                              │
│    - 创建 GitHub Release                                     │
│    - 附加下载文件 (.zip, .tar.gz)                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│               GitHub Pages (更新站点)                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  URL: https://[username].github.io/ruyisdk-eclipse-plugins/ │
│                                                             │
│  • artifacts.xml   (元数据)                                  │
│  • content.xml     (内容清单)                                │
│  • features/       (功能包)                                  │
│  • plugins/        (插件)                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                     用户端                                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Eclipse IDE                                                │
│    ↓                                                        │
│  配置自动更新 (Preferences → Automatic Updates)               │
│    ↓                                                        │
│  Eclipse 定期检查更新站点                                     │
│    ↓                                                        │
│  发现新版本 → 显示更新图标 🔄                                  │
│    ↓                                                        │
│  用户点击 → 安装更新 → 重启 Eclipse                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📚 相关文档索引

我已为您创建了以下详细文档：

### 🎯 用户文档
- **[USER_AUTO_UPDATE_GUIDE.md](USER_AUTO_UPDATE_GUIDE.md)** - 最终用户如何配置 Eclipse 自动更新

### 🛠️ 开发者/维护者文档
- **[GITHUB_SETUP_CHECKLIST.md](GITHUB_SETUP_CHECKLIST.md)** - GitHub 首次配置完整检查清单（⭐ 推荐先看这个）
- **[UPDATE_GUIDE.md](UPDATE_GUIDE.md)** - 版本发布和更新详细流程
- **[README.md](README.md)** - 已更新，包含安装和自动更新说明

### 🚀 自动化工具
- **[update-version.ps1](update-version.ps1)** - Windows PowerShell 版本更新脚本
- **[update-version.sh](update-version.sh)** - Linux/macOS Bash 版本更新脚本

### ⚙️ 配置文件
- **[repository/p2.inf](repository/p2.inf)** - P2 仓库元数据配置（新增）

---

## 🚀 快速开始（首次配置）

### 第一步：配置 GitHub Pages

```bash
# 1. 进入您的 GitHub 仓库
# 2. Settings → Pages
# 3. Source: Deploy from a branch
# 4. Branch: gh-pages
# 5. 点击 Save
```

### 第二步：推送代码触发构建

```bash
# 推送代码到 main 分支
git add .
git commit -m "feat: add auto-update documentation"
git push origin main

# 等待 GitHub Actions 构建完成
# 查看 Actions 标签页确认构建成功
```

### 第三步：验证更新站点

访问以下 URL，应该能看到您的更新站点：
```
https://[您的用户名].github.io/ruyisdk-eclipse-plugins/
```

如果能访问，说明配置成功！✅

### 第四步：在 Eclipse 中测试

1. 打开 Eclipse
2. `Help` → `Install New Software...`
3. 添加更新站点（URL 如上）
4. 应该能看到 "RuyiSDK IDE" 功能

---

## ⚠️ 重要提示

### 关于"自动通知"的理解

**Eclipse 的更新机制：**
- ✅ 可以自动检查更新（后台）
- ✅ 可以在状态栏显示更新图标
- ❌ 不会像手机 App 那样弹窗强制通知
- ❌ 不会发送邮件或推送通知

**用户需要做的：**
1. 安装插件后，配置自动更新（一次性）
2. Eclipse 会定期检查，发现更新时显示图标
3. 用户看到图标后，点击安装更新

**这是 Eclipse P2 更新机制的标准行为**，所有 Eclipse 插件都是这样工作的。

---

## 🎉 总结

### ✅ 您已经拥有的
1. ✅ GitHub Actions workflow 配置
2. ✅ P2 仓库配置文件
3. ✅ Release 自动化流程

### 🔧 您需要做的
1. 🔧 在 GitHub 上启用 Pages（5 分钟）
2. 🔧 配置 Actions 权限（2 分钟）
3. 🔧 推送代码触发首次构建（1 分钟）
4. ✅ 完成！之后就全自动了

### 📖 下一步
1. 阅读 [GITHUB_SETUP_CHECKLIST.md](GITHUB_SETUP_CHECKLIST.md) 完成首次配置
2. 使用 `update-version.ps1` 或 `update-version.sh` 更新版本号
3. 按照正常流程提交代码和创建 tag
4. GitHub Actions 会自动完成剩余工作

---

**祝您使用愉快！** 🚀

如有问题，请查看详细文档或在 GitHub Issues 中提问。

