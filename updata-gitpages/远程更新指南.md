# RuyiSDK Eclipse 插件 - 远程更新指南

## 🌐 概述

本文档说明如何通过远程 P2 更新站点安装和更新 RuyiSDK Eclipse 插件，无需手动下载和安装。

---

## 方法 1：GitHub Pages 在线更新站点 ⭐ (推荐)

### 用户安装步骤

1. **打开 Eclipse IDE**
   ```
   启动您的 RuyiSDK Eclipse IDE 或任何 Eclipse 2024-12 版本
   ```

2. **打开安装对话框**
   ```
   Help → Install New Software...
   ```

3. **添加更新站点**
   - 点击 **"Add..."** 按钮
   - 在弹出的对话框中填写：
     ```
     Name: RuyiSDK Plugins
     Location: https://exceed-zk.github.io/ruyisdk-eclipse-plugins/
     ```
   - 点击 **"Add"**

4. **安装插件**
   - 等待插件列表加载
   - 勾选 **"☑ RuyiSDK Feature"**
   - 点击 **"Next"** → **"Next"** → 接受许可 → **"Finish"**
   - 重启 Eclipse

5. **验证安装**
   ```
   Help → About Eclipse IDE → Installation Details
   → 查找 "RuyiSDK" 相关插件
   ```

### 检查更新

已安装插件后，Eclipse 会自动检查更新：

```
Help → Check for Updates
```

或设置自动更新：
```
Window → Preferences → Install/Update → Automatic Updates
→ ☑ Automatically find new updates and notify me
```

---

## 方法 2：GitHub Releases 下载安装

### 下载发行版

1. 访问 Releases 页面：
   ```
   https://github.com/exceed-zk/ruyisdk-eclipse-plugins/releases
   ```

2. 下载最新版本的 P2 仓库：
   - `ruyisdk-plugins-p2-v0.0.X.zip` (Windows/通用)
   - `ruyisdk-plugins-p2-v0.0.X.tar.gz` (Linux)

3. 解压到本地目录

### 本地安装

```
1. Help → Install New Software... → Add...

2. Name: RuyiSDK Plugins vX.X.X
   Location: file:///path/to/extracted/repository

3. 选择插件并安装
```

---

## 方法 3：直接从 GitHub 原始文件安装

### 使用 raw.githubusercontent.com

```
Help → Install New Software... → Add...

Name: RuyiSDK Plugins (GitHub)
Location: https://raw.githubusercontent.com/exceed-zk/ruyisdk-eclipse-plugins/gh-pages/
```

**注意**：此方法可能较慢，取决于网络状况。

---

## 🔄 更新流程

### 当插件有新版本时

#### 自动更新（推荐）

1. Eclipse 会在后台检查更新
2. 收到更新通知
3. 点击通知 → 选择更新 → 安装 → 重启

#### 手动更新

```
1. Help → Check for Updates

2. 如果有更新，会列出可用更新

3. 选择 "RuyiSDK" 相关更新

4. Next → Finish → 重启 Eclipse
```

---

## 🛠️ 维护者指南

### 发布新版本

#### 步骤 1：更新版本号

编辑各插件的 `pom.xml` 和 `MANIFEST.MF`：

```xml
<!-- pom.xml -->
<version>0.0.5-SNAPSHOT</version>

<!-- MANIFEST.MF -->
Bundle-Version: 0.0.5.qualifier
```

#### 步骤 2：提交并推送

```bash
git add .
git commit -m "Bump version to 0.0.5"
git push origin main
```

GitHub Actions 会自动：
- ✅ 构建插件
- ✅ 生成 P2 仓库
- ✅ 部署到 GitHub Pages

#### 步骤 3：创建 Release（可选）

```bash
git tag -a v0.0.5 -m "Release version 0.0.5"
git push origin v0.0.5
```

这会触发 Release 工作流，自动创建 GitHub Release 并上传 P2 仓库压缩包。

### 验证发布

1. **检查 GitHub Pages**
   ```
   访问：https://exceed-zk.github.io/ruyisdk-eclipse-plugins/
   ```

2. **检查 P2 仓库内容**
   ```
   https://exceed-zk.github.io/ruyisdk-eclipse-plugins/artifacts.jar
   https://exceed-zk.github.io/ruyisdk-eclipse-plugins/content.jar
   ```

3. **测试安装**
   ```
   在 Eclipse 中添加更新站点并尝试安装
   ```

---

## 🏗️ 集成到 RuyiSDK IDE

### 方法 A：预配置更新站点

在 RuyiSDK IDE 打包时，预先配置更新站点。

编辑 `packages/org.eclipse.epp.package.embedcpp.product/epp.product`：

```xml
<product ...>
  ...
  <repositories>
    <repository 
      url="https://exceed-zk.github.io/ruyisdk-eclipse-plugins/" 
      enabled="true" 
      name="RuyiSDK Plugins Update Site"/>
  </repositories>
</product>
```

用户打开 IDE 后，可以直接通过 `Help → Check for Updates` 更新插件。

### 方法 B：通过插件配置

创建一个配置插件，在首次启动时添加更新站点：

```java
// 在 org.ruyisdk.core 中
public class UpdateSiteConfigurer implements IStartup {
    @Override
    public void earlyStartup() {
        IProvisioningAgent agent = // 获取 P2 代理
        IMetadataRepositoryManager manager = // 获取仓库管理器
        
        URI updateSite = new URI("https://exceed-zk.github.io/ruyisdk-eclipse-plugins/");
        manager.addRepository(updateSite);
    }
}
```

---

## 📊 更新站点监控

### 检查构建状态

GitHub Actions 徽章：

```markdown
![Build Status](https://github.com/exceed-zk/ruyisdk-eclipse-plugins/workflows/Build%20and%20Publish%20P2%20Repository/badge.svg)
```

### 查看部署历史

```
Settings → Pages → 查看部署历史
```

---

## 🔍 故障排除

### 问题 1：无法访问更新站点

**症状**：Eclipse 报错 "Unable to read repository"

**解决**：
```
1. 检查网络连接
2. 确认 GitHub Pages 已启用
3. 访问 https://exceed-zk.github.io/ruyisdk-eclipse-plugins/ 确认可访问
4. 尝试使用 HTTP 代理（如果在公司网络）
```

### 问题 2：插件版本不更新

**症状**：Eclipse 显示 "No updates available"

**解决**：
```
1. 清理 Eclipse 缓存：
   Help → About → Installation Details → Update History
   
2. 手动刷新更新站点：
   Window → Preferences → Install/Update → Available Software Sites
   → 选择 RuyiSDK 站点 → Reload
   
3. 删除并重新添加更新站点
```

### 问题 3：GitHub Actions 构建失败

**检查**：
```
1. Actions 标签页查看错误日志
2. 常见原因：
   - Maven 构建失败
   - 权限问题（需要配置 GITHUB_TOKEN）
   - 依赖下载超时
```

---

## 🌍 国内用户优化

### 使用镜像加速

如果 GitHub 访问较慢，可以考虑：

#### 方案 1：使用 Gitee 镜像

1. 在 Gitee 创建镜像仓库
2. 启用 Gitee Pages
3. URL: `https://your-username.gitee.io/ruyisdk-eclipse-plugins/`

#### 方案 2：自建服务器

将 P2 仓库部署到国内服务器：

```bash
# 从 GitHub 同步
wget -r -np -nH --cut-dirs=1 \
  https://exceed-zk.github.io/ruyisdk-eclipse-plugins/

# 部署到 Nginx
sudo cp -r ruyisdk-eclipse-plugins /var/www/html/
```

---

## 📚 参考资源

### 官方文档

- [Eclipse P2 更新站点](https://wiki.eclipse.org/Equinox/p2)
- [GitHub Pages 部署](https://docs.github.com/en/pages)
- [GitHub Actions 工作流](https://docs.github.com/en/actions)

### 相关项目

- [ruyisdk-eclipse-packages](https://github.com/ruyisdk/ruyisdk-eclipse-packages)
- [ruyisdk-eclipse-plugins](https://github.com/ruyisdk/ruyisdk-eclipse-plugins)

---

## ✅ 最佳实践

### 对于开发者

1. ✅ 使用语义化版本号（v1.2.3）
2. ✅ 每次发布前充分测试
3. ✅ 维护 CHANGELOG
4. ✅ 自动化构建和部署

### 对于用户

1. ✅ 启用自动更新检查
2. ✅ 定期手动检查更新
3. ✅ 查看 Release Notes 了解新功能
4. ✅ 遇到问题及时反馈

---

## 🎉 总结

通过 GitHub Pages 和 GitHub Actions，您可以：

- ✅ **零成本**托管插件更新站点
- ✅ **全自动**构建和发布流程
- ✅ **全球访问**（通过 CDN）
- ✅ **版本管理**（通过 Git tags 和 Releases）

用户只需添加一次更新站点 URL，以后所有更新都会自动推送！

---

**最后更新**: 2025-10-17  
**维护者**: exceed-zk  
**仓库**: https://github.com/exceed-zk/ruyisdk-eclipse-plugins

